<!doctype html>
<html lang="pt-BR" class="page-transition">
<head>
  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Confirmação de Pedido - Delícias Tropicana</title>
  
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css?v=14"> 
  
  <style>
    /* ===============================
       ANIMAÇÃO DE ENTRADA (SPLASH)
    =============================== */
    #splash-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #FFD21E;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      animation: fadeOutSplash 1s ease 1.8s forwards;
    }
    #splash-screen img {
      width: 170px;
      animation: logoBounce 2.5s ease-in-out infinite;
      filter: drop-shadow(0 0 10px rgba(0,0,0,0.15));
    }
    @keyframes logoBounce {
      0%, 100% { transform: scale(1) translateY(0); }
      30% { transform: scale(1.15) translateY(-10px); }
      50% { transform: scale(0.95) translateY(5px); }
      70% { transform: scale(1.05) translateY(-5px); }
    }
    @keyframes fadeOutSplash {
      to { opacity: 0; visibility: hidden; }
    }

    /* ===============================
       TRANSIÇÃO DE CONTEÚDO
    =============================== */
    .fade-page {
        opacity: 0;
        transition: opacity 0.3s ease-in;
    }
    .fade-page.loaded {
        opacity: 1;
    }
    .page-transition.fade-out .fade-page {
        opacity: 0;
        transition: opacity 0.3s ease-out;
    }
    .page-transition.fade-out {
        overflow: hidden; 
    }

    /* ✅ Estilos do Resumo do Pedido */
    .resumo-content {
        display: flex;
        flex-direction: column;
        gap: 15px;
        padding: 15px 0;
    }
    .resumo-item {
        font-size: 0.95rem;
        line-height: 1.4;
        padding-bottom: 10px;
        border-bottom: 1px dotted #ccc;
    }
    .resumo-item:last-child {
        border-bottom: none;
        padding-bottom: 0;
    }
    .separator {
        color: #999;
        margin: 0 5px;
    }
    .detail-label {
        font-weight: 600;
    }
    .item-price {
        color: var(--color-alert, #e53935); 
        font-size: 1rem;
    }
  </style>
</head>

<body class="fade-page">
  <!-- ✅ Splash Screen -->
  <div id="splash-screen">
    <img src="logo.png" alt="Delícias Tropicana">
  </div>

  <main class="container">
    <section class="menu">
      <h2>✅ Quase lá! Confira seu Pedido:</h2>

      <div class="resumo-box section-card" id="resumoFinalContainer">
        <h3 class="section-title">Seu Nome:</h3>
        <div class="campo">
          <span class="label">Nome</span>
          <input type="text" id="nameInputFinal" placeholder="Ex.: Claudiane" required>
        </div>
        <hr style="margin: 20px 0; border: 0; border-top: 1px dashed #eee;">
        
        <h3 class="section-title">Resumo do Pedido:</h3>
        <div id="resumoPedido" class="resumo-content"></div>

        <div class="confirmation-actions"> 
          <div class="resumo-total-final resumo-total centralizado" id="totalAPagar"></div>

          <button id="enviarPedido" class="btn btn-whatsapp">
            Enviar Pedido via WhatsApp
          </button>
          <button id="voltarMenu" class="btn btn-voltar">
            Voltar e Adicionar Mais Saladas
          </button>
        </div>
      </div>
    </section>
  </main>

  <script>
    // Mantém a função handlePageTransition existente
    if(typeof handlePageTransition !== 'function') {
        window.handlePageTransition = function(url) {
            document.documentElement.classList.add('fade-out');
            setTimeout(() => { window.location.href = url; }, 300);
        };
    }

    // Exibe a animação de splash ao carregar a página
    document.addEventListener('DOMContentLoaded', () => {
      const splash = document.getElementById('splash-screen');
      setTimeout(() => {
        splash.style.display = 'none';
      }, 2800); // Mesmo tempo da animação inicial
    });

    // Variável global para o telefone
    const phone = '5565993321761'; 

    const formatCurrency = (value) => {
        return new Intl.NumberFormat('pt-BR', {
            style: 'currency',
            currency: 'BRL'
        }).format(value);
    };

    function calcularTotalGeral() {
        const pedidosJSON = localStorage.getItem('tropicanaPedidos');
        const pedidos = pedidosJSON ? JSON.parse(pedidosJSON) : [];
        let totalPedido = 0;
        pedidos.forEach(item => {
            totalPedido += item.total;
        });
        return totalPedido;
    }

    // ======================================================
    // FUNÇÃO PARA GERAR O TEXTO DO WHATSAPP
    // ======================================================
    const getWhatsappText = (total) => {
        const pedidos = JSON.parse(localStorage.getItem('tropicanaPedidos')) || [];
        const name = localStorage.getItem('tropicanaName') || 'Cliente';
        let text = `*NOVO PEDIDO - DELÍCIAS TROPICANA*\n\n`;
        text += `Meu nome é *${name.trim()}* e este é o meu pedido:\n\n`;
        pedidos.forEach((item, index) => {
            const precoUnitario = item.tamanho.preco;
            text += `ITEM ${index + 1}\n`; 
            text += `Tamanho: ${item.tamanho.nome} — ${formatCurrency(precoUnitario)}\n`;
            if (item.fruits?.length) {
                text += `\n*Frutas (Grátis):*\n`;
                item.fruits.forEach(fruta => text += `• ${fruta.nome}\n`);
            }
            if (item.extras?.length) {
                text += `\n*Adicionais de Fruta (R$2,00 cada):*\n`;
                item.extras.forEach(extra => text += `• ${extra.nome}\n`);
            }
            if (item.acomp?.length) {
                text += `\n*Acompanhamentos (Grátis):*\n`;
                item.acomp.forEach(acomp => text += `* ${acomp.nome}\n`);
            }
            const obs = item.observacoes || item.obs;
            if (obs?.trim() !== '') text += `\n*Observações*: ${obs.trim().replace(/\n/g, ' ')}\n`;
            text += `\n*Subtotal: ${formatCurrency(item.total)}*\n`;
            text += `---------------------------------\n`; 
        });
        text += `\n\nAguardando a confirmação do pedido e o cálculo da taxa de entrega.\n\n*Obrigado!*`;
        text += `\n\n*Valor Total R$ ${total.toFixed(2).replace('.', ',')}*`;
        return text;
    };

    // ======================================================
    // FUNÇÃO PRINCIPAL DE CARREGAMENTO
    // ======================================================
    function loadAndDisplayOrder() {
        const pedidosJSON = localStorage.getItem('tropicanaPedidos');
        const pedidos = pedidosJSON ? JSON.parse(pedidosJSON) : [];
        const resumoPedidoDiv = document.getElementById('resumoPedido');
        const totalAPagarDiv = document.getElementById('totalAPagar');
        const nameInput = document.getElementById('nameInputFinal');
        nameInput.value = localStorage.getItem('tropicanaName') || '';
        let resumoTexto = '';
        let totalPedido = 0;

        if (pedidos.length === 0) {
            resumoPedidoDiv.textContent = 'Nenhum pedido encontrado. Voltando ao menu...';
            totalAPagarDiv.textContent = 'TOTAL: R$0,00';
            handlePageTransition('index.html');
            return;
        }

        resumoTexto += pedidos.map((item, index) => {
            const totalItem = item.total; 
            let linha = `<div class="resumo-item"><strong>1x Salada #${index + 1} (${item.tamanho.nome}):</strong> `;
            let detalhes = [];
            if (item.fruits?.length) detalhes.push(`Frutas: ${item.fruits.map(f => f.nome).join(', ')}`);
            if (item.extras?.length) detalhes.push(`<span class="detail-label">Adic:</span> ${item.extras.map(e => e.nome).join(', ')}`);
            if (item.acomp?.length) detalhes.push(`<span class="detail-label">Acomp:</span> ${item.acomp.map(a => a.nome).join(', ')}`);
            const obs = item.observacoes || item.obs;
            if (obs) detalhes.push(`<span class="detail-label">Obs:</span> ${obs}`);
            linha += detalhes.join(' <span class="separator">|</span> ');
            linha += ` - <strong class="item-price">${formatCurrency(totalItem)}</strong></div>`; 
            totalPedido += totalItem;
            return linha;
        }).join('');
        
        resumoPedidoDiv.innerHTML = resumoTexto;
        totalAPagarDiv.textContent = 'TOTAL: ' + formatCurrency(totalPedido);

        // Botão WhatsApp
        document.getElementById('enviarPedido').addEventListener('click', () => {
            if (nameInput.value.trim() === '') {
                alert('Por favor, preencha seu nome.');
                return;
            }
            localStorage.setItem('tropicanaName', nameInput.value.trim());
            const totalPedido = calcularTotalGeral();
            let whatsappText = getWhatsappText(totalPedido);
            whatsappText = whatsappText.replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]|\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDFFF]|\uD83E[\uDC00-\uDFFF]|\u200D|\uFE0F/g, '');
            localStorage.setItem('pedidoWhatsApp', whatsappText);
            localStorage.removeItem('tropicanaPedidos');
            localStorage.removeItem('tropicanaName');
            handlePageTransition('sucesso.html'); 
        });

        // Botão Voltar (mantém animação splash)
        document.getElementById('voltarMenu').addEventListener('click', (e) => {
          e.preventDefault();
          const splash = document.createElement('div');
          splash.id = 'splash-screen';
          splash.innerHTML = `<img src="logo.png" alt="Delícias Tropicana">`;
          document.body.appendChild(splash);
          setTimeout(() => {
            window.location.href = 'index.html';
          }, 2800);
        });

        nameInput.addEventListener('input', () => localStorage.setItem('tropicanaName', nameInput.value.trim()));
    }

    document.addEventListener('DOMContentLoaded', function() {
        document.body.classList.add('loaded');
        loadAndDisplayOrder();
    });
  </script>
</body>
</html>
